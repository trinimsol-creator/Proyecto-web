{% extends "_layout_clean.html" %}

{% block title %}Mis Compras - COAST{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/miscompras.css') }}">
{% endblock %}

{% block content %}

<header class="titulo-pagina">Mis compras</header>

<div class="filtros">
  <button class="activo" onclick="filtrar('todos')">Todos</button>
  <button onclick="filtrar('entregado')">Entregados</button>
  <button onclick="filtrar('camino')">En camino</button>
  <button onclick="filtrar('cancelado')">Cancelados</button>
  <button onclick="filtrar('pendiente')">Pendientes</button>
  <button onclick="filtrar('preparacion')">En preparación</button>
</div>

<div id="lista-pedidos">

  {% if compras %}

    {% for compra in compras %}

      {% set estado_css = '' %}
      {% if compra.estado == 'Pendiente' %}
        {% set estado_css = 'pendiente' %}
      {% elif compra.estado == 'En preparación' %}
        {% set estado_css = 'preparacion' %}
      {% elif compra.estado == 'Listo para entregar' %}
        {% set estado_css = 'camino' %}
      {% elif compra.estado == 'Entregado' %}
        {% set estado_css = 'entregado' %}
      {% elif compra.estado == 'Cancelado' %}
        {% set estado_css = 'cancelado' %}
      {% endif %}

      <a href="{{ url_for('detalles') }}?id={{ compra.id_producto }}" class="link-pedido">

        <div class="pedido" data-estado="{{ estado_css }}">

          <img src="{{ url_for('static', filename='img/' ~ compra.img) }}" alt="{{ compra.nombre }}">

          <div class="info">
            <h3>{{ compra.nombre }}</h3>

            <p class="categoria">{{ compra.categoria }}</p>

            <p class="fecha">
              Compra realizada el {{ compra.fechahora.strftime('%d/%m/%Y') }}
            </p>

            <span class="estado {{ estado_css }}">

              {% if compra.estado == 'Listo para entregar' %}
                En camino
              {% else %}
                {{ compra.estado }}
              {% endif %}
            </span>
            
          </div>

          <div class="total">
            ${{ "%.2f"|format(compra.total) }}
          </div>

        </div>

      </a>

    {% endfor %}

  {% else %}

    <p class="info">Todavía no realizaste compras</p>

  {% endif %}

</div>

{% endblock %}

{% block js %}
<script src="{{ url_for('static', filename='js/miscompras.js') }}"></script>
{% endblock %}
